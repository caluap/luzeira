<!DOCTYPE html>
<html>
<head>


	<script 
		src="https://code.jquery.com/jquery-3.3.1.min.js"
		integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
		crossorigin="anonymous"></script>

	<script src="https://fastcdn.org/FileSaver.js/1.1.20151003/FileSaver.min.js"></script>

	<script>

		var versions = {
			'default': {
				'color': '#007cff',
				'luzeira': 'luzeira.svg',
				'astrologia': 'astrologia.svg'
			},
			'black': {
				'color': '#a7a9ac',
				'luzeira': 'luzeira_b_and_w.svg',
				'astrologia': 'astrologia_b_and_w.svg'
			},
			'white': {
				'color': '#a7a9ac',
				'luzeira': 'luzeira_inv_b_and_w.svg',
				'astrologia': 'astrologia_inv_b_and_w.svg'
			}
		}

		var used_version = 'default';


		// some constants
		var PLANET_WIDTH = 9,
				ASPECT_STROKE = 3;//PLANET_WIDTH/2;


		var planets = [];
		var data_is_dirty = false, svgs_are_dirty = true;
		// var planets = [0, 30, 60, 90, 120, 150, 180];
		function retrieve_data(date) {

			if (!date) {
				console.log('date is empty!');
				return;
			}

			var year = date.slice(0,4);
			var month = date.slice(5,7);
			var day = date.slice(8);

			if (parseInt(year) < 1900 || parseInt(year) > 2100) {
				alert('Sinto, mas temos dados apenas entre os anos de 1900 e 2100!');
				return;
			}
			
			
			$.getJSON( "clean_data/" + year + ".json", function( data ) {
				console.log('Data retrieved for: ' + year + '/' + month + '/' + day);
				var sign_adjustment = 180;
				var angles = [];
				angles.push(data[month][day]['sun'] + sign_adjustment);
				angles.push(data[month][day]['moon'] + sign_adjustment);
				angles.push(data[month][day]['mercury'] + sign_adjustment);
				angles.push(data[month][day]['venus'] + sign_adjustment);
				angles.push(data[month][day]['mars'] + sign_adjustment);
				angles.push(data[month][day]['jupiter'] + sign_adjustment);
				angles.push(data[month][day]['saturn'] + sign_adjustment);
				planets = angles;
				data_is_dirty = true;
			});
		}

		function return_date() {
			return $('#date').val();
		}

		function download_svg() {
			var file_name = "logo_luzeira-" + return_date() + '-' + used_version + ".svg";
			var url = "data:image/svg+xml;utf8," + encodeURIComponent(paper.project.exportSVG({asString:true}));
			var link = document.createElement("a");
			link.download = file_name;
			link.href = url;
			link.click();
		}

		function download_png() {
			var file_name = "logo_luzeira-" + return_date() + '-' + used_version + ".png";
			var canvas = document.getElementById("myCanvas"), ctx = canvas.getContext("2d");
			canvas.toBlob(function(blob) {
				saveAs(blob, file_name);
			});
		}

 	</script>

	<script type="text/javascript" src="paper-full.js"></script>
	<script type="text/paperscript" src="script.js" canvas="myCanvas" async></script>
</head>
<body>
	<style>
		body {
			padding: 0;
			margin: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			min-width: 100vw;
			min-height: 100vh;
			background: #ddd;
		}
		
		#myCanvas.default, #myCanvas.black {
			background: white;
		}

		#myCanvas.white {
			background: black;
		}

		* {
			font-family: monospace;
		}

		#radio {
			display: flex;
		}
		#radio > * {
			margin-right: 20px;
		}
	</style>

	<div id="c">
		<input type="date" id="date" name="date" min="1900-01-01" max="2100-12-31">
		<button onclick="retrieve_data($('#date').val());">Calcular!</button>
		<br><br>
	
		
		<canvas id="myCanvas" class="default" style="width: 800px; height: 400px; box-shadow: 0 1px 2px rgba(0,0,0,0.2);"></canvas>
		<br><br>
		<button onclick="download_svg()">Download SVG</button>
		<button onclick="download_png()">Download PNG</button>
		<br><br>
		<div id="radio">
			<label for="r1">
				<input type="radio" name="color" id="r1" value="default" checked onclick="$('#myCanvas').attr('class','default'); used_version = 'default'; svgs_are_dirty = true;">
				Default
			</label>
			<label for="r2">
				<input type="radio" name="color" id="r2" value="black" onclick="$('#myCanvas').attr('class','black'); used_version = 'black'; svgs_are_dirty = true;">
				Preto
			</label>
			<label for="r3">
				<input type="radio" name="color" id="r3" value="white" onclick="$('#myCanvas').attr('class','white'); used_version = 'white'; svgs_are_dirty = true;">
				Branco
			</label>
		</div>
		<br><br>
		<div id="radio">
			<label for="w2">
				<input type="radio" name="color" id="w2" value="2" onclick="ASPECT_STROKE = 2; data_is_dirty = true;">
				2
			</label>
			<label for="w3">
				<input type="radio" name="color" id="w3" value="3" checked onclick="ASPECT_STROKE = 3; data_is_dirty = true;">
				3
			</label>
			<label for="w4">
				<input type="radio" name="color" id="w4" value="4" onclick="ASPECT_STROKE = 4; data_is_dirty = true;">
				4
			</label>
			<label for="w5">
				<input type="radio" name="color" id="w5" value="5" onclick="ASPECT_STROKE = 5; data_is_dirty = true;">
				5
			</label>
		</div>
	</div>
	
	<script>
		$(function(){
			document.getElementById('date').valueAsDate = new Date();
			retrieve_data($('#date').val());
		})
	</script>

</body>
</html>